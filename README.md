# DLC-Detector-with-Language-Customization
è¿™æ˜¯æˆ‘ä»¬ [å·¥ç¨‹å­¦å¯¼è®ºï¼ˆME1221ï¼‰](https://oc.sjtu.edu.cn/courses/84663) è¯¾ç¨‹é¡¹ç›®çš„ç‰ˆæœ¬ç®¡ç†ä»“åº“ï¼Œæœ¬é¡¹ç›®æ—¨åœ¨å®ç°ä¸€ä¸ªåŸºäºCLIPçš„æ”¯æŒè¯­ä¹‰å®¢åˆ¶åŒ–çš„æ™ºèƒ½å…»è€æ‘„åƒå¤´æ¨¡å—çš„ç¡¬ä»¶æ”¯æŒæ€§å¼€å‘ã€åç«¯VLMå¼€å‘ä»¥åŠå‰ç«¯å¼€å‘ã€‚æŠ€æœ¯ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨å¤§è§„æ¨¡è¯­ä¹‰é¢„è®­ç»ƒçš„CLIPæ¨¡å‹ï¼Œé‡‡ç”¨ViTä½œä¸ºè§†è§‰ç¼–ç å™¨ï¼ŒVanilla Transformerä½œä¸ºè¯­ä¹‰ç¼–ç å™¨ï¼Œzero-shotåœ°è¿›è¡Œåœºæ™¯è¯†åˆ«ï¼Œä»è€Œå®ç°é«˜åº¦ä¸ªæ€§åŒ–çš„æ™ºèƒ½åŠŸèƒ½ã€‚

![DLCå…¨æ ˆæŠ€æœ¯æµç¨‹å›¾](./doc_asset/image/DLC.png)

***

## å†™åœ¨å‰é¢ï¼šç¯å¢ƒé…ç½®ä¸åŸºç¡€æ„å»º

### ç¬¬ä¸€æ­¥ï¼šæ„å»ºVSCodeä¸Python (Conda)å¼€å‘ç¯å¢ƒ

è¯·å‚è€ƒ[è¯¾ä»¶](./doc_asset/doc/Pythonçš„å®‰è£…ä¸ä½¿ç”¨.pptx)å®Œæˆç¯å¢ƒï¼ˆVSCode + Pythonï¼ˆCondaï¼‰ï¼‰çš„é…ç½®ï¼Œè‹¥ä¸­é€”é‡åˆ°é—®é¢˜ï¼ˆæ¯”å¦‚å’ŒC++çš„ç¼–è¯‘å™¨å‘ç”Ÿå¥‡æ€ªçš„å†²çªï¼‰ï¼Œå»ºè®®ä¸è¦ç€æ€¥ï¼Œæè¿°æ¸…æ¥šé—®é¢˜åè¯¢é—®AIã€‚æ­¤å¤„æ„Ÿè°¢[é­ç…Šè€å¸ˆ](https://www.acem.sjtu.edu.cn/faculty/weixuan.html)çš„è¯¾ç¨‹è¯¾ä»¶ï¼Œè¯·ä»…ç”¨äºå‚è€ƒï¼Œå‹¿è¿›è¡ŒäºŒæ¬¡ä¼ æ’­ã€‚

æœ‰å…³pythonè¯­æ³•ï¼Œæˆ‘ç›¸ä¿¡å¼€å‘ç›¸å…³åŒå­¦ä¸éœ€è¦å¤ªå¤šå­¦ä¹ ï¼Œè‹¥æœ‰éœ€è¦ï¼Œå¯ä»¥å‚è€ƒ[å®˜æ–¹æ–‡æ¡£](https://docs.python.org/zh-cn/3/)ä»¥åŠ[èœé¸Ÿæ•™ç¨‹](https://www.runoob.com/python3/python3-tutorial.html)ã€‚

### ç¬¬äºŒæ­¥ï¼šå®ŒæˆGithubå­¦ç”Ÿè®¤è¯å¹¶å¼€å§‹ä½¿ç”¨

è¯·å‚è€ƒ[è¿™ä¸ªæ•™ç¨‹](https://zhuanlan.zhihu.com/p/688730361)å®ŒæˆGithubå­¦ç”Ÿè®¤è¯ï¼Œä¹‹åå°±ä¼šè·å¾—Github Copilotçš„å…è´¹ä½¿ç”¨èµ„æ ¼ã€‚çœ‹èµ·æ¥æœ‰äº›éº»çƒ¦ï¼Œä½†æ˜¯åšå®Œä¹‹åèƒ½å¤Ÿé•¿ä¹…æé«˜ä½ çš„codingç”Ÿäº§åŠ›ï¼ŒAIå†™ä»£ç ç¡®å®æ˜¯å¾ˆé«˜æ•ˆçš„ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”³è¯·å¾ˆå¯èƒ½ä¸èƒ½ä¸€éè¿‡ï¼Œå¯ä»¥é’ˆå¯¹æ€§å†ä¸Šç½‘æœç´¢ä¸è¿‡çš„åŸå› ï¼ˆæ¯”å¦‚é’ˆå¯¹â€œä½ ä¸ºä»€ä¹ˆä¸åœ¨å­¦æ ¡â€çš„é—®é¢˜éœ€è¦ç”¨æµè§ˆå™¨åŠŸèƒ½æ”¹å®šä½ç»çº¬åº¦ä¹‹ç±»ï¼‰ï¼Œç›¸ä¿¡ä½ é‡åˆ°çš„é—®é¢˜æ€»æœ‰äººé‡åˆ°è¿‡å¹¶å†™è¿‡åˆ†äº«ã€‚è¦æ˜¯å®åœ¨ä¸è¡Œå¯ä»¥åœ¨[æ°´æºç¤¾åŒºæœ‰å…³å¸–å­](https://shuiyuan.sjtu.edu.cn/t/topic/405088)ä¸‹ç¤¼è²Œè¯¢é—®ã€‚

åœ¨è·å¾—å­¦ç”Ÿæƒç›ŠåŒ…ä¹‹åï¼Œå°±å¯ä»¥åœ¨VSCodeä¸­ä¸‹è½½copilotç›¸å…³æ’ä»¶ï¼Œå¹¶ä¸”å¼€å§‹ä½¿ç”¨ä»£ç†æ¨¡å¼ç”Ÿæˆå•¦ã€‚æœ‰å…³å¯èƒ½é‡åˆ°çš„Claudeä¸å¯¹ä¸­å›½IPå¼€æ”¾çš„é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒ[è¿™ä¸ªå¸–å­](https://www.xiaohongshu.com/explore/68d10aca000000000b03dcc2?app_platform=android&ignoreEngage=true&app_version=9.3.0&share_from_user_hidden=true&xsec_source=app_share&type=normal&xsec_token=CBCVGWu2SEszJUjiL-Lm3k5EuMaxULXqDBvZOYVc2o-mY=&author_share=1&xhsshare=WeixinSession&shareRedId=ODw5NTc6Oko2NzUyOTgwNjY2OTo3PkdA&apptime=1760021884&share_id=b95fbc0175974ad986e575235df49c27&share_channel=wechat)ã€‚æœ‰å…³å·¥ç¨‹é—®é¢˜ï¼Œæˆ‘å»ºè®®ä½¿ç”¨Claude Sonnet 4.5ï¼Œè¯•éªŒä¸‹æœ‰æœ€å¥½çš„å·¥ç¨‹ä»£ç è¡¨ç°ã€‚

### ç¬¬ä¸‰æ­¥ï¼šå­¦ä¹ Gitå’ŒGithubçš„ä½¿ç”¨æ–¹æ³•

å› ä¸ºç‰ˆæœ¬ç®¡ç†æ˜¯ç ç±»å­¦ç”Ÿç»å¯¹é€ƒä¸å¼€çš„ä¸€ä¸ªé‡è¦è½¯å®åŠ›ï¼Œ**å»ºè®®èŠ±ä¸€ä¸ªä¸‹åˆçš„æ—¶é—´æ²‰ä¸‹å¿ƒæ¥å­¦ä¹ [è¿™ä¸ªæ•™ç¨‹](https://www.runoob.com/git/git-tutorial.html)**ï¼Œå¹¶ä¸”è·Ÿç€æ•²ä¸€éï¼Œä¹‹åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸ä¼šçš„æ—¶å€™é—®AIäº†ã€‚

æ¯”å¦‚ï¼Œåœ¨æˆ‘ç°åœ¨åœ¨åšçš„å¦ä¸€ä¸ªé¡¹ç›®éœ€è¦ç‰ˆæœ¬ç®¡ç†ï¼Œä½†æ˜¯æˆ‘ä¸è®°å¾—ä¸€äº›æ“ä½œæŒ‡ä»¤çš„æ—¶å€™ï¼Œå¯ä»¥è¿™æ ·é—®AIï¼ˆä½†æ˜¯ä½ å¿…é¡»æ¸…æ¥šä½ åœ¨å¹²ä»€ä¹ˆï¼‰ï¼š

```
æˆ‘ç°åœ¨åœ¨æœåŠ¡å™¨ä¸Šçš„`robust_dev`åˆ†æ”¯è¿›è¡Œæ“ä½œï¼Œéœ€è¦å°†åœ¨codeupç®¡ç†çš„`dev`è¿™ä¸ªé»˜è®¤åˆ†æ”¯çš„å†…å®¹åˆå¹¶åˆ°ç°åœ¨çš„åˆ†æ”¯ï¼Œä½†æ˜¯æˆ‘ç°åœ¨çš„åˆ†æ”¯æœ‰5 commitsé¢†å…ˆäºé»˜è®¤åˆ†æ”¯ï¼Œ8 commitsè½åäºé»˜è®¤åˆ†æ”¯ï¼Œä¹Ÿå°±æ˜¯å­˜åœ¨æˆ‘æƒ³è¦ä¿ç•™çš„å·®å¼‚ï¼Œä½†æ˜¯åˆæœ‰éœ€è¦æ›´æ–°çš„ã€‚æ­¤å¤–ï¼Œæˆ‘çš„ç¬¬ä¸€ä¸ªå­åˆ†æ”¯çš„ç¬¬ä¸€ä¸ªcommitæ”¾è¿›äº†ä¸éœ€è¦ä¸Šä¼ codeupçš„ã€é‡Œé¢å­˜åœ¨å®é™…æ–‡ä»¶å’Œè½¯é“¾æ¥çš„assetsæ–‡ä»¶å¤¹ï¼Œæˆ‘å¸Œæœ›åœ¨åŒæ­¥å‰å°†å…¶ç§»å‡ºæ¥ï¼ŒåŒæ­¥åå†æ”¾å›å»ï¼Œæˆ‘åº”è¯¥æ€ä¹ˆæ“ä½œï¼Ÿ
```

å½“ä½ è®¤ä¸ºè‡ªå·±å­¦ä¼šäº†Git/Githubçš„åŸºæœ¬æ“ä½œæ—¶ï¼Œè¯·åœ¨é¡¹ç›®ç¾¤é‡Œè¿›è¡Œè¯´æ˜ï¼Œå¹¶ä¸”ç»™å‡ºä½ çš„Githubè´¦æˆ·ï¼Œæˆ‘ä»¬å°†ä¼šé‚€è¯·ä½ åŠ å…¥é¡¹ç›®ï¼Œå¹¶ä¸”ç»™ä½ ä¸€å®šçš„ä¿®æ”¹æƒé™ã€‚åœ¨æ­¤ä¹‹åï¼Œ**è¯·ä½ åœ¨`main`åˆ†æ”¯çš„åŸºç¡€ä¸Šåˆ›å»º`[å§“åé¦–å­—æ¯ç¼©å†™]_dev`ï¼ˆä¾‹å¦‚`jyy_dev`ï¼‰è¡¨ç¤ºè¿™æ˜¯ä½ çš„å¼€å‘åˆ†æ”¯**ã€‚åœ¨åç»­çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬çš„å¼€å‘æ¨¡å¼æ˜¯ï¼Œæ¯ä½åŒå­¦åœ¨è‡ªå·±çš„åˆ†æ”¯ä¸Šè¿›è¡Œå¼€å‘ï¼Œé€‚æ—¶å’Œ`main`åˆ†æ”¯ä¿æŒåŒæ­¥ï¼ˆå³ä»`main`æ‹‰å–æ›´æ–°ï¼‰ï¼Œåœ¨ä½ å®ŒæˆæŸä¸ªåŠŸèƒ½çš„å®ç°åï¼Œè¯·ä½ å…ˆåŒæ­¥åˆ°è‡ªå·±çš„å¼€å‘åˆ†æ”¯ä¸Šï¼Œç„¶åå‘èµ·pull requestï¼Œæˆ‘ï¼ˆé‡‘æŠ‘æ‰¬ï¼‰å°†ä¼šå®¡æ ¸ååˆå¹¶å…¥`main`åˆ†æ”¯ã€‚åŒæ—¶ï¼Œè¯·ä½ åœ¨å®Œæˆè‡ªå·±çš„å¼€å‘éƒ¨åˆ†åå¯¹äº[READMEæ–‡ä»¶](./README.md)è¿›è¡Œæ›´æ–°ï¼Œè¯´æ˜ä½ çš„å®ç°çš„ä¸€äº›ç›¸å…³ä»‹ç»ã€é‡è¦æ¥å£ã€å…¶ä»–å¼€å‘åŒå­¦åº”è¯¥å¦‚ä½•ä½¿ç”¨ä½ çš„æœ€æ–°å®ç°ï¼Œç­‰ç­‰ç­‰ç­‰ã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå‡å¦‚æœ‰ä¸€äº›å®é™…ä¸Šå¹¶ä¸éœ€è¦ä½¿ç”¨gitè·Ÿè¸ªä¸Šä¼ çš„æ–‡ä»¶ï¼Œå¯ä»¥å‚è€ƒ[.gitignoreçš„å†™æ³•](https://liaoxuefeng.com/books/git/customize/ignore/index.html)é‡Œé¢çš„æ•™ç¨‹ï¼Œæ¯”å¦‚ä½ å½•åˆ¶äº†ä¸€ä¸ªä¸€ä¸ªGçš„è§†é¢‘ï¼Œä½ è‚¯å®šä¸éœ€è¦ä¸Šä¼ å®ƒï¼Œå‡å¦‚å…¶åœ¨`assets/`æ–‡ä»¶å¤¹ä¸‹ï¼Œå°±å¯ä»¥è€ƒè™‘æŠŠè¿™ä¸ªæ–‡ä»¶å¤¹ä¸€æ•´ä¸ª`ignore`æ‰ã€‚

æœ€åï¼Œæ„Ÿè°¢ä½ å¯¹äºDLCé¡¹ç›®çš„å…´è¶£ï¼æˆ‘ä»¬çœŸè¯šå¸Œæœ›å¤§å®¶èƒ½å¤Ÿå’Œå¹³åº¦è¿‡è¿™é—¨é‡‘è¯¾â€”â€”**ä¸åç‰¢ã€æœ‰æˆé•¿ã€å–œäº¤æœ‹**ã€‚

***

## \[JYY\] é¡¹ç›® Infra ä»‹ç»

é¦–å…ˆï¼Œæˆ‘ï¼ˆé‡‘æŠ‘æ‰¬ï¼‰ä¼šåœ¨åˆ†é…ä»»åŠ¡å‰å®Œæˆä»£ç çš„æ¡†æ¶ï¼Œä¸‹é¢æ˜¯å¯¹äºæ–‡ä»¶ç»“æ„ã€ä»£ç åŠŸèƒ½çš„ä»‹ç»ã€‚ä¸‹é¢çš„ä¸œè¥¿æ˜¯**éœ€è¦ä»”ç»†çœ‹çš„**ï¼Œåœ¨çœ‹å®Œä¹‹åï¼Œå¯ä»¥æŠŠ`main`åˆ†æ”¯çš„è¿™ä¸ªinfra `merge`åˆ°**ä½ çš„å¼€å‘åˆ†æ”¯**ï¼Œå¹¶ä¸”åœ¨æœ¬åœ°è¯»ä¸€è¯»ç¡®åˆ‡çš„æ–‡ä»¶ç»“æ„ã€ ä»£ç æ¡†æ¶ã€‚ä¸€äº›æ“ä½œä¸Šã€å™¨ç‰©ä¸Šçš„è¯´æ˜ï¼Œå¯ä»¥å‚çœ‹[æˆ‘å‡†å¤‡çš„ç¯å¢ƒå…·ä½“é…ç½®æ–‡æ¡£ï¼ˆå»ºè®®condaï¼Œæœ‰é—®é¢˜éšæ—¶ç¾¤é‡Œé—®ï¼‰](./docs/QUICK_REFERENCE.md)â€”â€”è¦æ˜¯è¿™ä¸ªè¿‡ç¨‹è®©ä½ æåº¦ç—›è‹¦ï¼ŒåŒæ ·å¯ä»¥è€ƒè™‘è½¬éå¼€å‘è§’è‰²â€”â€”ä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹è¿˜æ˜¯å¿…è¦çš„ï¼Œå°¤å…¶å¯¹äºåç»­çš„è¯¾ç¨‹å’Œç§‘ç ”è€Œè¨€ï¼ˆä½†æ˜¯å¯¹å¤§ä¸€æ¥è¯´ç¡®å®å¤ªæ—©ï¼ŒçœŸè¯šä¸æ¨èå¾ˆæ—©è¿›ç»„â€”â€”å“å‘€è¯´å¼€å»äº†ï¼Œæ€»ä¹‹ä¸‹é¢çš„ä¸œè¥¿è¯·å¥½å¥½è¯»~ï¼‰ã€‚

### 1. é¡¹ç›®æ¦‚è¿°

#### 1.1 æ ¸å¿ƒåŠŸèƒ½

**åŸºç¡€åŠŸèƒ½**ï¼š
- âœ… å®æ—¶è§†é¢‘æµè¯»å–ä¸å…³é”®å¸§æå–
- âœ… åŸºäºCLIPçš„è¯­ä¹‰å®¢åˆ¶åŒ–äº‹ä»¶æ£€æµ‹
- âœ… è­¦æŠ¥ä¿¡æ¯è¾“å‡º

**æ‹“å±•åŠŸèƒ½**ï¼š
- ğŸ”„ çŸ­ä¿¡APIè­¦æŠ¥é€šçŸ¥
- ğŸ”„ éšç§ä¿æŠ¤ï¼ˆè§†è§‰æ©ç ï¼‰
- ğŸ”„ GUIå‰ç«¯ç•Œé¢
- ğŸ”„ åœºæ™¯è¿ç§»æµ‹è¯•

#### 1.2 è¾“å…¥æºæ”¯æŒ

é¡¹ç›®éœ€è¦æ”¯æŒä¸¤ç±»è¾“å…¥æºï¼Œå‡å­˜æ”¾åœ¨ `assets/` æ–‡ä»¶å¤¹ä¸‹ï¼š

1. **å®æ—¶è§†é¢‘æµ** (`assets/rtsp_streams/`)
   - ä»æµ·åº·å¨è§†ç›¸æœºæ¨¡å—è¯»å–RTSPåè®®æµ
   - æ”¯æŒä¸åŒåˆ†è¾¨ç‡ï¼ˆå¦‚720p, 1080pç­‰ï¼‰
   - å®æ—¶æŠ½å–å…³é”®å¸§è¿›è¡Œå¤„ç†

2. **ç¦»çº¿è§†é¢‘æ–‡ä»¶** (`assets/test_videos/`)
   - é¢„å…ˆå½•åˆ¶çš„æµ‹è¯•è§†é¢‘ï¼ˆmp4, aviç­‰æ ¼å¼ï¼‰
   - ç”¨äºåŠŸèƒ½æµ‹è¯•å’Œæ•ˆæœå±•ç¤º
   - æŒ‰å›ºå®šå¸§ç‡æˆ–åœºæ™¯å˜åŒ–æŠ½å–å…³é”®å¸§

---

### 2. æ–‡ä»¶ç»“æ„è¯´æ˜

```
DLC-Detector-with-Language-Customization/
â”‚
â”œâ”€â”€ assets/                          # è¾“å…¥èµ„æºç›®å½•
â”‚   â”œâ”€â”€ rtsp_streams/               # RTSPå®æ—¶æµé…ç½®
â”‚   â”‚   â”œâ”€â”€ stream_configs.json    # æµåœ°å€å’Œå‚æ•°é…ç½®
â”‚   â”‚   â””â”€â”€ README.md              # RTSPæµä½¿ç”¨è¯´æ˜
â”‚   â””â”€â”€ test_videos/               # æµ‹è¯•è§†é¢‘æ–‡ä»¶
â”‚       â”œâ”€â”€ fall_detection/        # è·Œå€’æ£€æµ‹æµ‹è¯•è§†é¢‘
â”‚       â”œâ”€â”€ fire_detection/        # ç«ç¾æ£€æµ‹æµ‹è¯•è§†é¢‘
â”‚       â””â”€â”€ normal_scenarios/      # æ­£å¸¸åœºæ™¯è§†é¢‘
â”‚
â”œâ”€â”€ config/                         # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ camera_config.yaml         # ç›¸æœºå‚æ•°é…ç½®
â”‚   â”œâ”€â”€ model_config.yaml          # CLIPæ¨¡å‹é…ç½®
â”‚   â””â”€â”€ detection_config.yaml      # æ£€æµ‹é˜ˆå€¼å’Œåœºæ™¯é…ç½®
â”‚
â”œâ”€â”€ data/                          # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ logs/                      # è¿è¡Œæ—¥å¿—
â”‚   â”œâ”€â”€ models/                    # é¢„è®­ç»ƒæ¨¡å‹å­˜æ”¾
â”‚   â”‚   â””â”€â”€ clip/                 # CLIPæ¨¡å‹æƒé‡
â”‚   â””â”€â”€ outputs/                   # è¾“å‡ºç»“æœ
â”‚       â”œâ”€â”€ alerts/               # è­¦æŠ¥è®°å½•
â”‚       â””â”€â”€ frames/               # æå–çš„å…³é”®å¸§
â”‚
â”œâ”€â”€ src/                           # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                      # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ video_capture.py      # è§†é¢‘æ•è·å’Œå…³é”®å¸§æå–
â”‚   â”‚   â”œâ”€â”€ clip_detector.py      # CLIPæ¨¡å‹æ£€æµ‹å™¨
â”‚   â”‚   â””â”€â”€ alert_manager.py      # è­¦æŠ¥ç®¡ç†å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                    # æ¨¡å‹ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ clip_wrapper.py       # CLIPæ¨¡å‹å°è£…
â”‚   â”‚   â””â”€â”€ vision_encoder.py     # è§†è§‰ç¼–ç å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                     # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ image_processing.py   # å›¾åƒé¢„å¤„ç†
â”‚   â”‚   â”œâ”€â”€ config_loader.py      # é…ç½®åŠ è½½å™¨
â”‚   â”‚   â””â”€â”€ logger.py             # æ—¥å¿—å·¥å…·
â”‚   â”‚
â”‚   â””â”€â”€ alert/                     # è­¦æŠ¥åŠŸèƒ½ï¼ˆæ‹“å±•ï¼‰
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ sms_sender.py         # çŸ­ä¿¡å‘é€
â”‚       â””â”€â”€ notification.py        # é€šçŸ¥ç®¡ç†
â”‚
â”œâ”€â”€ scripts/                       # è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ download_models.py        # ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹
â”‚   â”œâ”€â”€ test_camera.py            # æµ‹è¯•ç›¸æœºè¿æ¥
â”‚   â””â”€â”€ run_demo.py               # è¿è¡Œæ¼”ç¤º
â”‚
â”œâ”€â”€ tests/                         # æµ‹è¯•ä»£ç 
â”‚   â”œâ”€â”€ test_video_capture.py    # è§†é¢‘æ•è·æµ‹è¯•
â”‚   â”œâ”€â”€ test_clip_detector.py    # æ£€æµ‹å™¨æµ‹è¯•
â”‚   â””â”€â”€ test_integration.py       # é›†æˆæµ‹è¯•
â”‚
â”œâ”€â”€ gui/                           # GUIç•Œé¢ï¼ˆæ‹“å±•ï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main_window.py            # ä¸»çª—å£
â”‚   â””â”€â”€ settings_panel.py         # è®¾ç½®é¢æ¿
â”‚
â”œâ”€â”€ docs/                          # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ API.md                    # APIæ–‡æ¡£
â”‚   â””â”€â”€ USER_GUIDE.md             # ç”¨æˆ·æŒ‡å—
â”‚
â”œâ”€â”€ requirements.txt               # Pythonä¾èµ–
â”œâ”€â”€ main.py                        # ä¸»ç¨‹åºå…¥å£
â””â”€â”€ README.md                      # é¡¹ç›®è¯´æ˜
```

### 3. æŠ€æœ¯å®ç°æ–¹æ¡ˆ

#### 3.1 è§†é¢‘æ•è·ä¸å…³é”®å¸§æå–

**è¾“å…¥æºå¤„ç†**ï¼š

```python
# ä¼ªä»£ç ç¤ºæ„
class VideoCapture:
    def __init__(self, source_type, source_path):
        """
        source_type: 'rtsp' æˆ– 'video'
        source_path: RTSP URL æˆ– è§†é¢‘æ–‡ä»¶è·¯å¾„
        """
        pass
    
    def get_frame(self):
        """è·å–ä¸‹ä¸€å¸§"""
        pass
    
    def extract_keyframes(self, method='interval'):
        """
        æå–å…³é”®å¸§
        method: 'interval' (å›ºå®šé—´éš”) æˆ– 'scene' (åœºæ™¯å˜åŒ–)
        """
        pass
```

**å…³é”®å¸§æå–ç­–ç•¥**ï¼š

1. **å›ºå®šé—´éš”æ³•**ï¼ˆä¼˜å…ˆå®ç°ï¼‰
   - æ¯éš”Nå¸§æå–ä¸€å¸§ï¼ˆNå¯é…ç½®ï¼Œå»ºè®®30-60ï¼‰
   - ä¼˜ç‚¹ï¼šç®€å•é«˜æ•ˆ
   - ç¼ºç‚¹ï¼šå¯èƒ½é”™è¿‡çŸ­æš‚äº‹ä»¶

2. **åœºæ™¯å˜åŒ–æ£€æµ‹æ³•**ï¼ˆå¯é€‰ä¼˜åŒ–ï¼Œæ€ªå¤æ‚çš„ï¼Œæˆ‘ï¼ˆé‡‘æŠ‘æ‰¬ï¼‰ä¸æ˜¯å¾ˆå»ºè®®ï¼‰
   - è®¡ç®—ç›¸é‚»å¸§çš„å·®å¼‚ï¼ˆå¦‚ç›´æ–¹å›¾å·®å¼‚ï¼‰
   - è¶…è¿‡é˜ˆå€¼åˆ™è®¤ä¸ºåœºæ™¯å˜åŒ–ï¼Œæå–å…³é”®å¸§
   - ä¼˜ç‚¹ï¼šæ›´æ™ºèƒ½ï¼Œä¸ä¼šé—æ¼é‡è¦æ—¶åˆ»
   - ç¼ºç‚¹ï¼šè®¡ç®—é‡ç¨å¤§

---

#### 3.2 CLIPæ¨¡å‹é›†æˆ

**æ¨¡å‹é€‰æ‹©**ï¼š
- **OpenAI CLIP**: `openai/clip-vit-base-patch32`
- **OpenCLIP**: `laion/CLIP-ViT-B-32-laion2B-s34B-b79K` (æ›´å¤§è§„æ¨¡é¢„è®­ç»ƒ)

**æ£€æµ‹æµç¨‹**ï¼š

```python
# ä¼ªä»£ç ç¤ºæ„
class CLIPDetector:
    def __init__(self, model_name):
        self.model = load_clip_model(model_name)
        self.processor = load_clip_processor()
    
    def detect(self, image, text_prompts, threshold=0.25):
        """
        image: PIL Image æˆ– numpy array
        text_prompts: List[str], å¦‚ ["a person falling down", "a fire"]
        threshold: ç›¸ä¼¼åº¦é˜ˆå€¼
        
        è¿”å›: Dict[str, float] - {åœºæ™¯: ç›¸ä¼¼åº¦åˆ†æ•°}
        """
        # 1. å›¾åƒç¼–ç 
        image_features = self.encode_image(image)
        
        # 2. æ–‡æœ¬ç¼–ç 
        text_features = self.encode_text(text_prompts)
        
        # 3. è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦
        similarities = cosine_similarity(image_features, text_features)
        
        # 4. åˆ¤æ–­æ˜¯å¦è¶…è¿‡é˜ˆå€¼
        results = {}
        for i, prompt in enumerate(text_prompts):
            if similarities[i] > threshold:
                results[prompt] = similarities[i]
        
        return results
```

**æ–‡æœ¬æç¤ºè¯è®¾è®¡**ï¼š

| åœºæ™¯ | è‹±æ–‡æç¤ºè¯ | ä¸­æ–‡æç¤ºè¯ï¼ˆå‚è€ƒï¼‰ |
|------|-----------|-------------------|
| è·Œå€’ | "a person falling down", "an elderly person fallen on the ground" | ä¸€ä¸ªäººæ‘”å€’äº†ï¼Œè€äººå€’åœ¨åœ°ä¸Š |
| ç«ç¾ | "fire in a room", "flames and smoke" | æˆ¿é—´é‡Œç€ç«äº†ï¼Œç«ç„°å’ŒçƒŸé›¾ |
| æ°´æ·¹ | "floor covered with water", "flooding indoors" | åœ°æ¿è¢«æ°´è¦†ç›–ï¼Œå®¤å†…æ·¹æ°´ |
| æ­£å¸¸ | "a person standing normally", "everyday home scene" | äººæ­£å¸¸ç«™ç«‹ï¼Œæ—¥å¸¸å®¶åº­åœºæ™¯ |

**ä¼˜åŒ–æŠ€å·§**ï¼š
- ä½¿ç”¨å¤šä¸ªç›¸ä¼¼æç¤ºè¯å–å¹³å‡å€¼ï¼Œæé«˜é²æ£’æ€§
- å¼•å…¥"æ­£å¸¸åœºæ™¯"ä½œä¸ºå¯¹ç…§ï¼Œä½¿ç”¨å¯¹æ¯”åˆ†æ•°åˆ¤æ–­å¼‚å¸¸

---

#### 3.3 è­¦æŠ¥ç®¡ç†

**è­¦æŠ¥ç­–ç•¥**ï¼š

```python
class AlertManager:
    def __init__(self, config):
        self.thresholds = config['thresholds']
        self.alert_history = []
        self.cooldown_time = 30  # å†·å´æ—¶é—´ï¼ˆç§’ï¼‰
    
    def should_alert(self, detection_results):
        """
        é¿å…é‡å¤è­¦æŠ¥ï¼š
        - åŒä¸€åœºæ™¯åœ¨å†·å´æ—¶é—´å†…ä¸é‡å¤è­¦æŠ¥
        - è¿ç»­Nå¸§æ£€æµ‹åˆ°æ‰è§¦å‘ï¼ˆå¯é€‰ï¼‰
        """
        pass
    
    def trigger_alert(self, scene, confidence):
        """
        è§¦å‘è­¦æŠ¥ï¼š
        - æ‰“å°åˆ°ç»ˆç«¯
        - è®°å½•åˆ°æ—¥å¿—
        - å‘é€çŸ­ä¿¡ï¼ˆå¦‚æœå¯ç”¨ï¼‰
        """
        pass
```

---

#### 3.4 é…ç½®æ–‡ä»¶è®¾è®¡

**`config/detection_config.yaml`**:

```yaml
detection:
  # æ£€æµ‹åœºæ™¯é…ç½®
  scenarios:
    fall:
      enabled: true
      prompts:
        - "a person falling down"
        - "an elderly person fallen on the ground"
      threshold: 0.25
      cooldown: 30  # ç§’
    
    fire:
      enabled: true
      prompts:
        - "fire in a room"
        - "flames and smoke"
      threshold: 0.30
      cooldown: 60
  
  # å…³é”®å¸§æå–
  keyframe:
    method: "interval"  # interval æˆ– scene
    interval: 30  # æ¯30å¸§æå–ä¸€æ¬¡
    scene_threshold: 0.3  # åœºæ™¯å˜åŒ–é˜ˆå€¼

# è­¦æŠ¥é…ç½®
alert:
  print_to_console: true
  save_to_log: true
  sms_enabled: false  # æ‹“å±•åŠŸèƒ½
  sms_contacts:
    - "+86138XXXXXXXX"
```
### 4. å¼€å‘ä¸ä½¿ç”¨è§„èŒƒ

#### 4.1 ä»£ç è§„èŒƒ

- **ç¼–ç æ ‡å‡†**: PEP 8
- **å‘½åè§„èŒƒ**:
  - ç±»å: `PascalCase`
  - å‡½æ•°/å˜é‡: `snake_case`
  - å¸¸é‡: `UPPER_CASE`
- **æ³¨é‡Šè¦æ±‚**:
  - æ¯ä¸ªå‡½æ•°å¿…é¡»æœ‰docstring
  - å¤æ‚é€»è¾‘å¿…é¡»æœ‰è¡Œå†…æ³¨é‡Š
- **ç±»å‹æç¤º**: æ¨èä½¿ç”¨Pythonç±»å‹æ³¨è§£

#### 4.2 é¢„æƒ³ä¸­çš„å¿«é€Ÿå¼€å§‹ï¼ˆæ˜¾ç„¶ç°åœ¨è¿˜æ²¡æœ‰å®ç°å®Œï¼Œå¼€å§‹ä¸äº†ä¸€ç‚¹ï¼‰

##### 4.2.1 ç¯å¢ƒæ­å»º

```bash
# 1. å…‹éš†ä»“åº“
git clone <repo-url>
cd DLC-Detector-with-Language-Customization

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate  # Windows

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. ä¸‹è½½CLIPæ¨¡å‹
python scripts/download_models.py
```

##### 4.2.2 è¿è¡Œæµ‹è¯•

```bash
# æµ‹è¯•ç›¸æœºè¿æ¥
python scripts/test_camera.py

# è¿è¡Œdemo
python scripts/run_demo.py --source video --path assets/test_videos/fall_detection/test1.mp4
```

##### 4.2.3 è¿è¡Œä¸»ç¨‹åº

```bash
# ä½¿ç”¨RTSPæµ
python main.py --source rtsp --config config/detection_config.yaml

# ä½¿ç”¨æµ‹è¯•è§†é¢‘
python main.py --source video --path assets/test_videos/fall_detection/test1.mp4
```

---

- ä¸€äº›å°å°çš„æ•™ç¨‹
  - CLIPå®è·µæ•™ç¨‹: https://huggingface.co/docs/transformers/model_doc/clip
  - OpenCVè§†é¢‘å¤„ç†: https://docs.opencv.org/4.x/dd/d43/tutorial_py_video_display.html

TODOï¼š

- [x] ã€1019å‰ã€‘å®ç°infra
- [x] ã€1023å·¦å³ã€‘å†™infraçš„æ–‡æ¡£
- [x] ã€Throughoutã€‘å’•å’•å’•å‘œå‘œå‘œå“‡å“‡å“‡
- [ ] ã€1023å·¦å³ã€‘æŠ€æœ¯å¯¹é½ä¼šè®®ï¼ˆè¯¾ä¸Šï¼‰
- [ ] é‡‡ä¹°å·¥ä½œ
- [ ] èƒŒæ™¯ etc. å†™ä½œ
- [ ] [è§†é¢‘æ•è·æ¨¡å—](src/core/video_capture.py) â†’ è°ƒç”¨detector.detect(frame)
- [ ] [è­¦æŠ¥ç®¡ç†å™¨](src/core/alert_manager.py) â†’ æ¥æ”¶resultå­—å…¸
- [ ] [ä¸»ç¨‹åº](main.py) â†’ æ•´åˆæ‰€æœ‰æ¨¡å—

---

## \[LXR\] GUI å›¾å½¢ç•Œé¢æ¨¡å—ä»‹ç»

GUIï¼ˆå›¾å½¢ç”¨æˆ·ç•Œé¢ï¼‰æ¨¡å—ä¸ºDLCæ£€æµ‹ç³»ç»Ÿæä¾›äº†ç›´è§‚æ˜“ç”¨çš„å¯è§†åŒ–æ“ä½œç•Œé¢ï¼Œè®©ç”¨æˆ·æ— éœ€ç¼–å†™ä»£ç å³å¯ä½¿ç”¨ç³»ç»Ÿçš„å…¨éƒ¨åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯GUIæ¨¡å—çš„åŠŸèƒ½è¯´æ˜å’Œä½¿ç”¨æŒ‡å—ã€‚

### 1. GUI æ¨¡å—æ¦‚è¿°

#### 1.1 æ ¸å¿ƒåŠŸèƒ½

**å·²å®ç°åŠŸèƒ½**ï¼š
- âœ… å®æ—¶è§†é¢‘æµé¢„è§ˆï¼ˆæœ¬åœ°æ‘„åƒå¤´ï¼‰
- âœ… è§†é¢‘æ’­æ”¾æ§åˆ¶ï¼ˆå¼€å§‹/æš‚åœ/åœæ­¢ï¼‰
- âœ… åœºæ™¯é…ç½®é¢æ¿
- âœ… è‡ªé€‚åº”çª—å£å¸ƒå±€ï¼ˆä¿æŒå®½é«˜æ¯”ï¼‰
- âœ… é«˜å¸§ç‡è§†é¢‘æ˜¾ç¤ºï¼ˆ60fpsï¼‰

**åŠŸèƒ½ç‰¹æ€§**ï¼š
- ğŸ“¹ **è§†é¢‘é¢„è§ˆ**ï¼šå®æ—¶æ˜¾ç¤ºæœ¬åœ°æ‘„åƒå¤´ç”»é¢ï¼Œæ”¯æŒè‡ªåŠ¨ç¼©æ”¾å’Œå±…ä¸­æ˜¾ç¤º
- ğŸ¬ **åœºæ™¯ç®¡ç†**ï¼šæ”¯æŒè‡ªå®šä¹‰åœºæ™¯ç±»å‹ï¼ˆå¦‚"æ‘”å€’"ã€"èµ·ç«"ç­‰ï¼‰
- âš™ï¸ **å‚æ•°é…ç½®**ï¼šå¯é…ç½®å…‰ç…§æ¡ä»¶ã€æ£€æµ‹åŒºåŸŸï¼ˆROIï¼‰ã€æŠ¥è­¦æ–¹å¼ç­‰
- ğŸ¨ **å‹å¥½ç•Œé¢**ï¼šé‡‡ç”¨ttkä¸»é¢˜æ ·å¼ï¼Œç•Œé¢ç®€æ´ç¾è§‚

#### 1.2 æ¨¡å—ç»“æ„

```
gui/
â”œâ”€â”€ __init__.py              # åŒ…åˆå§‹åŒ–æ–‡ä»¶
â”œâ”€â”€ main_window.py           # ä¸»çª—å£ï¼ˆè§†é¢‘æ˜¾ç¤ºå’Œæ§åˆ¶ï¼‰
â”œâ”€â”€ settings_panel.py        # è®¾ç½®é¢æ¿ï¼ˆåœºæ™¯é…ç½®ï¼‰
â”œâ”€â”€ CAMERA_FLOW.md          # æ‘„åƒå¤´è§†é¢‘æµå®ç°æ–‡æ¡£
â””â”€â”€ kawaii_icon.png         # çª—å£å›¾æ ‡
```

---

### 2. ä¸»çª—å£åŠŸèƒ½è¯´æ˜

#### 2.1 ç•Œé¢å¸ƒå±€

ä¸»çª—å£é‡‡ç”¨ç»å…¸çš„å•æ å¸ƒå±€ï¼š
- **é¡¶éƒ¨åŒºåŸŸ**ï¼šå®æ—¶è§†é¢‘é¢„è§ˆç”»å¸ƒï¼ˆ16:9æ¯”ä¾‹ï¼‰
- **åº•éƒ¨åŒºåŸŸ**ï¼šæ§åˆ¶æŒ‰é’®æ ï¼ˆå±…ä¸­æ’åˆ—ï¼‰

#### 2.2 æ§åˆ¶æŒ‰é’®

| æŒ‰é’® | å›¾æ ‡ | åŠŸèƒ½è¯´æ˜ | å¿«æ·é”® |
|------|------|----------|--------|
| å¼€å§‹æ£€æµ‹ | â–¶ | å¯åŠ¨æœ¬åœ°æ‘„åƒå¤´å¹¶å¼€å§‹å®æ—¶æ˜¾ç¤º | - |
| æš‚åœ | â¸ | æš‚åœè§†é¢‘æ’­æ”¾ï¼ˆä¸é‡Šæ”¾æ‘„åƒå¤´èµ„æºï¼‰ | - |
| åœæ­¢ | â¹ | åœæ­¢è§†é¢‘æµå¹¶é‡Šæ”¾æ‰€æœ‰èµ„æº | - |
| è®¾ç½® | âš™ | æ‰“å¼€è®¾ç½®é¢æ¿è¿›è¡Œåœºæ™¯é…ç½® | - |

#### 2.3 è§†é¢‘å¤„ç†æµç¨‹

```
æœ¬åœ°æ‘„åƒå¤´(cv2.VideoCapture)
    â†“
è¯»å–è§†é¢‘å¸§(BGRæ ¼å¼)
    â†“
é¢œè‰²ç©ºé—´è½¬æ¢(BGR â†’ RGB)
    â†“
è°ƒæ•´å¤§å°(ä¿æŒå®½é«˜æ¯”)
    â†“
è½¬æ¢ä¸ºPIL.Image
    â†“
è½¬æ¢ä¸ºImageTk.PhotoImage
    â†“
Canvasæ˜¾ç¤º(60fps, 17ms/å¸§)
```

#### 2.4 çª—å£ç‰¹æ€§

- **è‡ªé€‚åº”ç¼©æ”¾**ï¼šçª—å£å¤§å°æ”¹å˜æ—¶è‡ªåŠ¨è°ƒæ•´è§†é¢‘æ˜¾ç¤ºåŒºåŸŸ
- **ä¿æŒå®½é«˜æ¯”**ï¼šä¸»çª—å£å§‹ç»ˆä¿æŒ16:9çš„å®½é«˜æ¯”
- **å±…ä¸­æ˜¾ç¤º**ï¼šè§†é¢‘ç”»é¢åœ¨ç”»å¸ƒä¸­å±…ä¸­æ˜¾ç¤ºï¼Œå¤šä½™åŒºåŸŸå¡«å……é»‘è‰²
- **é«˜æ€§èƒ½**ï¼š60fpsåˆ·æ–°ç‡ï¼Œå»¶è¿Ÿä»…17ms

---

### 3. è®¾ç½®é¢æ¿åŠŸèƒ½è¯´æ˜

#### 3.1 é¢æ¿å¸ƒå±€

è®¾ç½®é¢æ¿é‡‡ç”¨å·¦å³åŒæ å¸ƒå±€ï¼š
- **å·¦ä¾§å¯¼èˆªæ **ï¼šåœºæ™¯é…ç½®æŒ‰é’®
- **å³ä¾§å†…å®¹åŒº**ï¼šå…·ä½“é…ç½®é€‰é¡¹

#### 3.2 åœºæ™¯é…ç½®é€‰é¡¹

**åœºæ™¯ç±»å‹ç®¡ç†**ï¼š
- å†…ç½®åœºæ™¯ï¼š`æ‘”å€’`ã€`èµ·ç«`
- æ”¯æŒè‡ªå®šä¹‰æ–°åœºæ™¯
- æ”¯æŒåˆ é™¤è‡ªå®šä¹‰åœºæ™¯ï¼ˆå†…ç½®åœºæ™¯ä¸å¯åˆ é™¤ï¼‰

**åœºæ™¯å‚æ•°é…ç½®**ï¼š

| å‚æ•°ç±»åˆ« | é…ç½®é¡¹ | è¯´æ˜ |
|---------|--------|------|
| **åœºæ™¯ç±»å‹** | ä¸‹æ‹‰é€‰æ‹©æ¡† | é€‰æ‹©å½“å‰è¦é…ç½®çš„åœºæ™¯ |
| **å…‰ç…§æ¡ä»¶** | æ˜äº®/æ­£å¸¸/æ˜æš— | å•é€‰æ¡†ï¼Œå½±å“æ£€æµ‹ç®—æ³•çš„å‚æ•° |
| **æ£€æµ‹åŒºåŸŸ** | å¯ç”¨ROI | å¤é€‰æ¡†ï¼Œæ˜¯å¦å¯ç”¨æ„Ÿå…´è¶£åŒºåŸŸæ£€æµ‹ |
| **æŠ¥è­¦è®¾ç½®** | å£°éŸ³æŠ¥è­¦/é‚®ä»¶é€šçŸ¥ | å¤é€‰æ¡†ï¼Œé…ç½®è­¦æŠ¥æ–¹å¼ |
| **å½•åƒè®¾ç½®** | äº‹ä»¶è§¦å‘æ—¶è‡ªåŠ¨å½•åƒ | å¤é€‰æ¡†ï¼Œæ˜¯å¦åœ¨æ£€æµ‹åˆ°äº‹ä»¶æ—¶å½•åƒ |

**æ“ä½œæŒ‰é’®**ï¼š
- `â• æ–°å»ºåœºæ™¯`ï¼šå¼¹å‡ºå¯¹è¯æ¡†è¾“å…¥æ–°åœºæ™¯åç§°
- `åˆ é™¤åœºæ™¯`ï¼šåˆ é™¤å½“å‰é€‰ä¸­çš„è‡ªå®šä¹‰åœºæ™¯
- `è®¾ç½®ROIåŒºåŸŸ`ï¼šæ‰“å¼€ROIåŒºåŸŸé€‰æ‹©ç•Œé¢ï¼ˆå¾…å®ç°ï¼‰
- `ä¿å­˜åœºæ™¯é…ç½®`ï¼šä¿å­˜å½“å‰é…ç½®åˆ°å†…å­˜

#### 3.3 é…ç½®æŒä¹…åŒ–

è®¾ç½®é¢æ¿çš„é…ç½®æ•°æ®å­˜å‚¨åœ¨ä¸»çª—å£çš„ `app_config` å­—å…¸ä¸­ï¼š

```python
app_config = {
    "scene": {
        "scene_type": "æ‘”å€’",           # å½“å‰åœºæ™¯ç±»å‹
        "light_condition": "normal",    # å…‰ç…§æ¡ä»¶
        "enable_roi": False,            # æ˜¯å¦å¯ç”¨ROI
        "enable_sound": True,           # å£°éŸ³æŠ¥è­¦
        "enable_email": False,          # é‚®ä»¶é€šçŸ¥
        "auto_record": False,           # è‡ªåŠ¨å½•åƒ
    },
    "scene_types": ["æ‘”å€’", "èµ·ç«"],   # åœºæ™¯ç±»å‹åˆ—è¡¨
}
```

---

### 4. ä¸»è¦æ¥å£è¯´æ˜

#### 4.1 MainWindow ç±»ï¼ˆmain_window.pyï¼‰

**åˆå§‹åŒ–æ–¹æ³•**ï¼š
```python
class MainWindow:
    def __init__(self) -> None:
        """åˆå§‹åŒ–ä¸»çª—å£ï¼Œåˆ›å»ºGUIç»„ä»¶å¹¶å¯åŠ¨äº‹ä»¶å¾ªç¯"""
```

**æ ¸å¿ƒæ–¹æ³•**ï¼š

| æ–¹æ³•å | åŠŸèƒ½è¯´æ˜ |
|--------|----------|
| `_on_start_detection()` | å¼€å§‹æ£€æµ‹æŒ‰é’®å›è°ƒï¼Œå¯åŠ¨æ‘„åƒå¤´ |
| `_on_pause()` | æš‚åœ/æ¢å¤è§†é¢‘æ’­æ”¾ |
| `_on_stop()` | åœæ­¢è§†é¢‘æµå¹¶é‡Šæ”¾èµ„æº |
| `_on_settings()` | æ‰“å¼€è®¾ç½®é¢æ¿ |
| `_start_video_stream()` | å¯åŠ¨è§†é¢‘æ•è·ï¼ˆcv2.VideoCaptureï¼‰ |
| `_stop_video_stream()` | åœæ­¢è§†é¢‘æ•è·å¹¶æ¸…ç†èµ„æº |
| `_update_video_frame()` | æ›´æ–°è§†é¢‘å¸§ï¼ˆ60fpså¾ªç¯è°ƒç”¨ï¼‰ |
| `_resize_frame()` | è°ƒæ•´å¸§å¤§å°ä»¥é€‚åº”ç”»å¸ƒ |

**é‡è¦å±æ€§**ï¼š

| å±æ€§å | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `video_capture` | cv2.VideoCapture | OpenCVè§†é¢‘æ•è·å¯¹è±¡ |
| `is_playing` | bool | æ˜¯å¦æ­£åœ¨æ’­æ”¾ |
| `is_paused` | bool | æ˜¯å¦å·²æš‚åœ |
| `app_config` | dict | åº”ç”¨é…ç½®æ•°æ® |

#### 4.2 SettingsPanel ç±»ï¼ˆsettings_panel.pyï¼‰

**åˆå§‹åŒ–æ–¹æ³•**ï¼š
```python
class SettingsPanel:
    def __init__(self, parent: Union[tk.Tk, tk.Toplevel], 
                 app_config: Dict = None) -> None:
        """
        åˆå§‹åŒ–è®¾ç½®é¢æ¿
        
        Args:
            parent: çˆ¶çª—å£å¯¹è±¡
            app_config: åº”ç”¨é…ç½®å­—å…¸ï¼ˆå¼•ç”¨ä¼ é€’ï¼Œä¿®æ”¹ä¼šåŒæ­¥åˆ°ä¸»çª—å£ï¼‰
        """
```

**æ ¸å¿ƒæ–¹æ³•**ï¼š

| æ–¹æ³•å | åŠŸèƒ½è¯´æ˜ |
|--------|----------|
| `show_page(page_name)` | æ˜¾ç¤ºæŒ‡å®šé…ç½®é¡µé¢ |
| `_create_scene_page()` | åˆ›å»ºåœºæ™¯é…ç½®é¡µé¢ |
| `_on_scene_change()` | åœºæ™¯ç±»å‹æ”¹å˜æ—¶çš„å›è°ƒ |
| `_create_new_scene()` | åˆ›å»ºæ–°åœºæ™¯ï¼ˆå¼¹å‡ºè¾“å…¥å¯¹è¯æ¡†ï¼‰ |
| `_delete_current_scene()` | åˆ é™¤å½“å‰é€‰ä¸­çš„åœºæ™¯ |
| `_save_scene_config()` | ä¿å­˜åœºæ™¯é…ç½®åˆ° app_config |

---

### 5. ä½¿ç”¨æŒ‡å—

#### 5.1 å¯åŠ¨GUI

**æ–¹æ³•ä¸€ï¼šç›´æ¥è¿è¡Œä¸»çª—å£**
```bash
cd /path/to/DLC-Detector-with-Language-Customization
python gui/main_window.py
```

**æ–¹æ³•äºŒï¼šç‹¬ç«‹æµ‹è¯•è®¾ç½®é¢æ¿**
```bash
python gui/settings_panel.py
```

#### 5.2 åŸºæœ¬æ“ä½œæµç¨‹

1. **å¯åŠ¨åº”ç”¨**
   ```bash
   python gui/main_window.py
   ```

2. **å¼€å§‹æ£€æµ‹**
   - ç‚¹å‡» `â–¶ å¼€å§‹æ£€æµ‹` æŒ‰é’®
   - ç³»ç»Ÿè‡ªåŠ¨æ‰“å¼€é»˜è®¤æ‘„åƒå¤´ï¼ˆè®¾å¤‡ID=0ï¼‰
   - è§†é¢‘ç”»é¢å¼€å§‹å®æ—¶æ˜¾ç¤º

3. **é…ç½®åœºæ™¯**
   - ç‚¹å‡» `âš™ è®¾ç½®` æŒ‰é’®æ‰“å¼€è®¾ç½®é¢æ¿
   - åœ¨åœºæ™¯é…ç½®é¡µé¢é€‰æ‹©æˆ–æ–°å»ºåœºæ™¯
   - é…ç½®åœºæ™¯å‚æ•°ï¼ˆå…‰ç…§ã€ROIã€æŠ¥è­¦ç­‰ï¼‰
   - ç‚¹å‡» `ä¿å­˜åœºæ™¯é…ç½®` ä¿å­˜è®¾ç½®

4. **æ§åˆ¶æ’­æ”¾**
   - `â¸ æš‚åœ`ï¼šæš‚åœè§†é¢‘æ˜¾ç¤º
   - å†æ¬¡ç‚¹å‡» `â¸ æš‚åœ`ï¼šæ¢å¤æ’­æ”¾
   - `â¹ åœæ­¢`ï¼šåœæ­¢è§†é¢‘æµå¹¶é‡Šæ”¾æ‘„åƒå¤´

#### 5.3 è‡ªå®šä¹‰åœºæ™¯ç¤ºä¾‹

å‡è®¾è¦æ·»åŠ "é—¯å…¥æ£€æµ‹"åœºæ™¯ï¼š

1. ç‚¹å‡» `âš™ è®¾ç½®` æ‰“å¼€è®¾ç½®é¢æ¿
2. ç‚¹å‡» `â• æ–°å»ºåœºæ™¯` æŒ‰é’®
3. åœ¨å¯¹è¯æ¡†ä¸­è¾“å…¥ "é—¯å…¥"
4. ç‚¹å‡» `âœ“ ç¡®å®š`
5. åœ¨åœºæ™¯ç±»å‹ä¸‹æ‹‰æ¡†ä¸­é€‰æ‹© "é—¯å…¥"
6. é…ç½®è¯¥åœºæ™¯çš„å‚æ•°
7. ç‚¹å‡» `ä¿å­˜åœºæ™¯é…ç½®`

---

### 6. æŠ€æœ¯ç»†èŠ‚

#### 6.1 è§†é¢‘å¸§ç‡ä¼˜åŒ–

- **ç›®æ ‡å¸§ç‡**ï¼š60fps
- **åˆ·æ–°é—´éš”**ï¼š17ms (1000ms / 60fps â‰ˆ 17ms)
- **å®ç°æ–¹å¼**ï¼š`root.after(17, self._update_video_frame)`
- **ç¼“å†²è®¾ç½®**ï¼š`CAP_PROP_BUFFERSIZE = 1`ï¼ˆå‡å°‘å»¶è¿Ÿï¼‰

#### 6.2 é¢œè‰²ç©ºé—´è½¬æ¢

OpenCVé»˜è®¤ä½¿ç”¨BGRæ ¼å¼ï¼Œè€ŒPIL/Tkinterä½¿ç”¨RGBæ ¼å¼ï¼š
```python
frame_rgb = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
```

#### 6.3 å›¾åƒæ ¼å¼è½¬æ¢é“¾

```
numpy.ndarray (OpenCV BGR)
    â†“ cv2.cvtColor()
numpy.ndarray (RGB)
    â†“ Image.fromarray()
PIL.Image
    â†“ ImageTk.PhotoImage()
ImageTk.PhotoImage
    â†“ canvas.create_image()
æ˜¾ç¤ºåœ¨Canvasä¸Š
```

#### 6.4 å†…å­˜ç®¡ç†

å¿…é¡»ä¿æŒPhotoImageçš„å¼•ç”¨ï¼Œå¦åˆ™ä¼šè¢«Pythonåƒåœ¾å›æ”¶ï¼š
```python
self.video_canvas.image = photo  # ä¿æŒå¼•ç”¨
```

#### 6.5 çª—å£ç¼©æ”¾æœºåˆ¶

- ä¸»çª—å£ä¿æŒ16:9å®½é«˜æ¯”
- è®¾ç½®é¢æ¿ä¿æŒ3:2å®½é«˜æ¯”
- ä½¿ç”¨ `<Configure>` äº‹ä»¶ç›‘å¬çª—å£å¤§å°å˜åŒ–
- åŠ¨æ€è°ƒæ•´å‡ ä½•å½¢çŠ¶ä»¥ä¿æŒæ¯”ä¾‹

---

### 7. æ‰©å±•å¼€å‘å»ºè®®

#### 7.1 ä¸æ£€æµ‹æ¨¡å—é›†æˆ

åœ¨ `_update_video_frame()` æ–¹æ³•ä¸­æ·»åŠ æ£€æµ‹è°ƒç”¨ï¼š

```python
def _update_video_frame(self) -> None:
    if not self.is_paused:
        ret, frame = self.video_capture.read()
        if ret:
            # ç°æœ‰çš„æ˜¾ç¤ºé€»è¾‘
            frame_rgb = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
            
            # ğŸ”¥ é›†æˆæ£€æµ‹æ¨¡å—
            if hasattr(self, 'clip_detector'):
                scene_type = self.app_config["scene"]["scene_type"]
                results = self.clip_detector.detect(
                    frame_rgb, 
                    prompts=self._get_prompts_for_scene(scene_type),
                    threshold=0.25
                )
                
                # å¤„ç†æ£€æµ‹ç»“æœ
                if results:
                    self._handle_detection_results(results)
            
            # ç»§ç»­æ˜¾ç¤ºé€»è¾‘...
```

#### 7.2 æ·»åŠ æ£€æµ‹ç»“æœæ˜¾ç¤º

å¯ä»¥åœ¨è§†é¢‘ç”»å¸ƒä¸Šå åŠ æ£€æµ‹ç»“æœï¼š

```python
def _draw_detection_overlay(self, canvas, results):
    """åœ¨ç”»å¸ƒä¸Šç»˜åˆ¶æ£€æµ‹ç»“æœ"""
    # åœ¨ç”»å¸ƒé¡¶éƒ¨æ˜¾ç¤ºæ£€æµ‹åˆ°çš„åœºæ™¯
    canvas.create_text(
        10, 10,
        text=f"æ£€æµ‹ç»“æœ: {results}",
        anchor="nw",
        fill="red",
        font=("Arial", 14, "bold")
    )
```

#### 7.3 å®ç°ROIé€‰æ‹©åŠŸèƒ½

`_set_roi_area()` æ–¹æ³•å½“å‰ä¸ºå ä½ç¬¦ï¼Œå¯ä»¥å®ç°ä¸ºï¼š

```python
def _set_roi_area(self):
    """æ‰“å¼€ROIé€‰æ‹©çª—å£"""
    roi_window = tk.Toplevel(self.parent)
    roi_window.title("é€‰æ‹©æ£€æµ‹åŒºåŸŸ")
    
    # æ˜¾ç¤ºå½“å‰è§†é¢‘å¸§
    # å…è®¸ç”¨æˆ·ç”¨é¼ æ ‡æ¡†é€‰åŒºåŸŸ
    # ä¿å­˜ROIåæ ‡åˆ°é…ç½®
```

---

### 8. å¸¸è§é—®é¢˜

#### Q1: æ‘„åƒå¤´æ— æ³•æ‰“å¼€ï¼Ÿ
**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
- macOSéœ€è¦æˆäºˆç»ˆç«¯/Pythonæ‘„åƒå¤´è®¿é—®æƒé™
- ç¡®è®¤è®¾å¤‡IDæ˜¯å¦æ­£ç¡®ï¼ˆé»˜è®¤ä¸º0ï¼‰
- æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–ç¨‹åºå ç”¨æ‘„åƒå¤´

#### Q2: è§†é¢‘æ˜¾ç¤ºå¡é¡¿ï¼Ÿ
**A**: å¯èƒ½åŸå› ï¼š
- CPUæ€§èƒ½ä¸è¶³ä»¥æ”¯æŒ60fps
- æ‘„åƒå¤´ç¡¬ä»¶ä¸æ”¯æŒ60fps
- å¯ä»¥åœ¨ä»£ç ä¸­å°†17msæ”¹ä¸º33msï¼ˆ30fpsï¼‰é™ä½æ€§èƒ½è¦æ±‚

#### Q3: çª—å£å¤§å°è°ƒæ•´åè§†é¢‘å˜å½¢ï¼Ÿ
**A**: è¿™ä¸åº”è¯¥å‘ç”Ÿï¼Œçª—å£å·²ç»å®ç°äº†å®½é«˜æ¯”é”å®šã€‚å¦‚æœå‡ºç°æ­¤é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
- `_on_window_resize()` æ–¹æ³•æ˜¯å¦æ­£å¸¸å·¥ä½œ
- `aspect_ratio` æ˜¯å¦è®¾ç½®æ­£ç¡®

#### Q4: è®¾ç½®æ— æ³•ä¿å­˜ï¼Ÿ
**A**: å½“å‰é…ç½®ä»…ä¿å­˜åœ¨å†…å­˜ä¸­ï¼ˆ`app_config`å­—å…¸ï¼‰ï¼Œå…³é—­çª—å£åä¼šä¸¢å¤±ã€‚æœªæ¥å¯ä»¥å®ç°ï¼š
- å°†é…ç½®ä¿å­˜åˆ°JSONæ–‡ä»¶
- åœ¨å¯åŠ¨æ—¶åŠ è½½é…ç½®æ–‡ä»¶

---

### 9. ç›¸å…³æ–‡æ¡£

- [æ‘„åƒå¤´è§†é¢‘æµå®ç°æ–‡æ¡£](gui/CAMERA_FLOW.md) - è¯¦ç»†çš„æŠ€æœ¯å®ç°è¯´æ˜
- [ä¸»çª—å£æºç ](gui/main_window.py) - MainWindowç±»å®ç°
- [è®¾ç½®é¢æ¿æºç ](gui/settings_panel.py) - SettingsPanelç±»å®ç°

---

**GUIæ¨¡å—å¼€å‘è€…**: LXRï¼ˆæä¿®ç„¶ï¼‰  
**æœ€åæ›´æ–°**: 2025å¹´11æœˆ9æ—¥


````

