# RTSP视频流使用说明

## ✅ 已实现的功能

### 1. 视频流播放
- ✅ 从RTSP流读取视频
- ✅ 实时显示在主窗口画布上
- ✅ 自动调整视频大小以适应窗口
- ✅ 保持视频原始宽高比
- ✅ 居中显示视频画面

### 2. 播放控制
- ✅ **开始检测** - 启动RTSP视频流
- ✅ **暂停** - 暂停/恢复视频播放
- ✅ **停止** - 停止视频流并释放资源
- ✅ **设置** - 打开设置面板

### 3. 连接管理
- ✅ RTSP URL输入对话框
- ✅ 连接状态检测
- ✅ 断线自动提示
- ✅ 资源自动清理

## 🚀 使用方法

### 方式一：通过对话框输入RTSP地址

1. 运行主窗口：
```bash
/usr/local/bin/python3 gui/main_window.py
```

2. 点击"▶ 开始检测"按钮

3. 在弹出的对话框中输入RTSP地址，例如：
```
rtsp://admin:password@192.168.1.100:554/stream
rtsp://username:password@camera_ip:port/path
rtsp://192.168.1.64:8554/live
```

4. 点击"确定"，视频流将自动连接并播放

### 方式二：在设置面板中配置（待集成）

1. 点击"⚙ 设置"按钮
2. 在"RTSP流配置"页面输入：
   - RTSP URL
   - 用户名/密码
   - 端口号
   - 超时时间
3. 保存配置
4. 返回主窗口，点击"▶ 开始检测"

## 📋 RTSP地址格式

### 通用格式
```
rtsp://[username:password@]host[:port]/path
```

### 常见示例

**海康威视摄像头：**
```
rtsp://admin:12345@192.168.1.64:554/Streaming/Channels/101
rtsp://admin:password@192.168.1.64:554/h264/ch1/main/av_stream
```

**大华摄像头：**
```
rtsp://admin:admin@192.168.1.108:554/cam/realmonitor?channel=1&subtype=0
```

**宇视摄像头：**
```
rtsp://admin:admin@192.168.1.100:554/video1
```

**通用IP摄像头：**
```
rtsp://admin:password@192.168.1.100:554/stream
rtsp://192.168.1.100:8554/live
```

**测试流（公共）：**
```
rtsp://wowzaec2demo.streamlock.net/vod/mp4:BigBuckBunny_115k.mp4
```

## 🎮 控制按钮说明

| 按钮 | 功能 | 状态要求 |
|------|------|----------|
| ▶ 开始检测 | 启动RTSP视频流 | 未播放或已暂停 |
| ⏸ 暂停 | 暂停/恢复播放 | 正在播放 |
| ⏹ 停止 | 停止视频流 | 正在播放 |
| ⚙ 设置 | 打开设置面板 | 任意时候 |

## 🔧 技术特性

### 视频处理
- **帧率**：约30fps (33ms/帧)
- **颜色空间**：自动转换BGR → RGB
- **缓冲区**：设置为1，减少延迟
- **插值算法**：INTER_AREA (高质量缩放)

### 错误处理
- ✅ 连接失败提示
- ✅ 断线自动检测
- ✅ 异常捕获和日志
- ✅ 资源自动释放

### 性能优化
- ✅ 最小缓冲区延迟
- ✅ 智能帧缩放
- ✅ 内存引用管理
- ✅ 定时器清理

## ⚠️ 注意事项

1. **网络连接**：确保摄像头与电脑在同一网络或可访问
2. **防火墙**：检查554端口是否开放
3. **认证信息**：用户名和密码需正确
4. **流地址**：不同品牌摄像头的路径可能不同
5. **性能**：高分辨率视频可能需要更好的硬件

## 🐛 常见问题

### Q1: 无法连接到RTSP流
**解决方法：**
- 检查IP地址和端口是否正确
- 验证用户名和密码
- 确认摄像头RTSP功能已启用
- 尝试用VLC等播放器测试流地址

### Q2: 视频卡顿或延迟
**解决方法：**
- 检查网络带宽
- 降低视频分辨率
- 使用子码流而非主码流
- 检查CPU使用率

### Q3: 视频自动断开
**解决方法：**
- 检查网络稳定性
- 增加超时时间
- 检查摄像头设置

## 🔄 下一步开发

- [ ] 从设置面板读取RTSP配置
- [ ] 保存RTSP地址历史记录
- [ ] 支持多路视频流
- [ ] 添加录像功能
- [ ] 集成检测算法
- [ ] 性能监控面板

## 📞 技术支持

如有问题，请查看控制台输出的错误信息，或联系开发团队。
