# æ‘„åƒå¤´è§†é¢‘æµå®ç°é€»è¾‘

## ğŸ“‹ æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·ç‚¹å‡»"å¼€å§‹æ£€æµ‹"   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é€‰æ‹©è§†é¢‘æºå¯¹è¯æ¡†    â”‚
â”‚  ğŸ“· æœ¬åœ°æ‘„åƒå¤´        â”‚
â”‚  ğŸ“¡ RTSPç½‘ç»œæµ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OpenCVæ‰“å¼€æ‘„åƒå¤´/RTSPæµ   â”‚ â†â”€â”€ cv2.VideoCapture(0) æˆ– cv2.VideoCapture(url)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è¯»å–è§†é¢‘å¸§ (å¾ªç¯)   â”‚ â†â”€â”€ ret, frame = video_capture.read()
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BGR â†’ RGB è½¬æ¢         â”‚ â†â”€â”€ cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è°ƒæ•´å¤§å°ï¼ˆä¿æŒå®½é«˜æ¯”ï¼‰  â”‚ â†â”€â”€ _resize_frame(frame_rgb, width, height)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è½¬æ¢ä¸º PIL.Image             â”‚ â†â”€â”€ Image.fromarray(frame_resized)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è½¬æ¢ä¸º ImageTk.PhotoImage    â”‚ â†â”€â”€ ImageTk.PhotoImage(image=image)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tkinter Canvas æ˜¾ç¤ºå›¾åƒ  â”‚ â†â”€â”€ canvas.create_image(x, y, image=photo)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 33msåç»§ç»­ä¸‹ä¸€å¸§ (30fps)  â”‚ â†â”€â”€ root.after(33, update_video_frame)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ (å¾ªç¯)
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚
                      â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ æš‚åœ/åœæ­¢/ç»§ç»­    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”‘ æ ¸å¿ƒä»£ç å®ç°

### 1. å¯åŠ¨è§†é¢‘æµ (`_start_video_stream`)

```python
def _start_video_stream(self) -> None:
    # åˆ¤æ–­è§†é¢‘æºç±»å‹
    if self.rtsp_url == "0":
        # æœ¬åœ°æ‘„åƒå¤´ (è®¾å¤‡IDä¸º0)
        self.video_capture = cv2.VideoCapture(0)
    else:
        # RTSPç½‘ç»œæµ
        self.video_capture = cv2.VideoCapture(self.rtsp_url)
    
    # è®¾ç½®ç¼“å†²åŒºï¼Œå‡å°‘å»¶è¿Ÿ
    self.video_capture.set(cv2.CAP_PROP_BUFFERSIZE, 1)
    
    # æ£€æŸ¥æ˜¯å¦æˆåŠŸæ‰“å¼€
    if not self.video_capture.isOpened():
        # é”™è¯¯å¤„ç†
        return
    
    # å¯åŠ¨å¸§æ›´æ–°å¾ªç¯
    self._update_video_frame()
```

### 2. æ›´æ–°è§†é¢‘å¸§ (`_update_video_frame`)

```python
def _update_video_frame(self) -> None:
    # ========== æ­¥éª¤1: è¯»å–è§†é¢‘å¸§ ==========
    ret, frame = self.video_capture.read()
    
    if ret:
        # ========== æ­¥éª¤2: BGR â†’ RGB è½¬æ¢ ==========
        # OpenCVä½¿ç”¨BGRæ ¼å¼ï¼ŒPILä½¿ç”¨RGBæ ¼å¼
        frame_rgb = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
        
        # ========== æ­¥éª¤3: è°ƒæ•´å¤§å° ==========
        frame_resized = self._resize_frame(frame_rgb, width, height)
        
        # ========== æ­¥éª¤4: è½¬æ¢ä¸ºPILå›¾åƒ ==========
        image = Image.fromarray(frame_resized)
        
        # ========== æ­¥éª¤5: è½¬æ¢ä¸ºImageTkæ ¼å¼ ==========
        photo = ImageTk.PhotoImage(image=image)
        
        # ========== æ­¥éª¤6: åœ¨Canvasä¸Šæ˜¾ç¤º ==========
        self.video_canvas.create_image(
            width // 2, height // 2,
            image=photo,
            anchor=tk.CENTER
        )
        
        # ä¿æŒå¼•ç”¨ï¼Œé˜²æ­¢è¢«åƒåœ¾å›æ”¶
        self.video_canvas.image = photo
    
    # ========== æ­¥éª¤7: è°ƒåº¦ä¸‹ä¸€å¸§ (30fps) ==========
    self.update_id = self.root.after(33, self._update_video_frame)
```

### 3. è°ƒæ•´å¸§å¤§å° (`_resize_frame`)

```python
def _resize_frame(self, frame, canvas_width, canvas_height):
    # è·å–åŸå§‹å°ºå¯¸
    frame_height, frame_width = frame.shape[:2]
    
    # è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ï¼ˆä¿æŒå®½é«˜æ¯”ï¼‰
    width_ratio = canvas_width / frame_width
    height_ratio = canvas_height / frame_height
    scale_ratio = min(width_ratio, height_ratio)
    
    # è®¡ç®—æ–°å°ºå¯¸
    new_width = int(frame_width * scale_ratio)
    new_height = int(frame_height * scale_ratio)
    
    # ä½¿ç”¨OpenCVè°ƒæ•´å¤§å°
    resized_frame = cv2.resize(
        frame, 
        (new_width, new_height), 
        interpolation=cv2.INTER_AREA
    )
    
    # åˆ›å»ºé»‘è‰²èƒŒæ™¯å¹¶å±…ä¸­æ”¾ç½®
    output = np.zeros((canvas_height, canvas_width, 3), dtype=np.uint8)
    y_offset = (canvas_height - new_height) // 2
    x_offset = (canvas_width - new_width) // 2
    output[y_offset:y_offset+new_height, x_offset:x_offset+new_width] = resized_frame
    
    return output
```

## ğŸ¯ å…³é”®æŠ€æœ¯ç‚¹

### 1. è§†é¢‘æºé€‰æ‹©
- **æœ¬åœ°æ‘„åƒå¤´**: `cv2.VideoCapture(0)` - 0è¡¨ç¤ºé»˜è®¤æ‘„åƒå¤´
- **RTSPæµ**: `cv2.VideoCapture("rtsp://...")` - ä¼ å…¥RTSP URL

### 2. é¢œè‰²ç©ºé—´è½¬æ¢
- **OpenCV**: é»˜è®¤ä½¿ç”¨ BGR æ ¼å¼
- **PIL/Tkinter**: ä½¿ç”¨ RGB æ ¼å¼
- **è½¬æ¢**: `cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)`

### 3. å›¾åƒæ ¼å¼è½¬æ¢é“¾
```
numpy.ndarray (OpenCV) 
    â†’ PIL.Image (Image.fromarray) 
    â†’ ImageTk.PhotoImage (ImageTk.PhotoImage) 
    â†’ Tkinter Canvas
```

### 4. å¸§ç‡æ§åˆ¶
- **ç›®æ ‡å¸§ç‡**: 30fps
- **åˆ·æ–°é—´éš”**: 33ms (1000ms / 30fps â‰ˆ 33ms)
- **å®ç°**: `self.root.after(33, self._update_video_frame)`

### 5. å†…å­˜ç®¡ç†
```python
# å¿…é¡»ä¿æŒPhotoImageå¼•ç”¨ï¼Œå¦åˆ™ä¼šè¢«åƒåœ¾å›æ”¶å¯¼è‡´å›¾åƒä¸æ˜¾ç¤º
self.video_canvas.image = photo
```

## âš™ï¸ é…ç½®å‚æ•°

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|-----|------|
| CAP_PROP_BUFFERSIZE | 1 | ç¼“å†²åŒºå¤§å°ï¼Œå‡å°‘å»¶è¿Ÿ |
| å¸§ç‡ | 30fps | æ¯ç§’30å¸§ |
| åˆ·æ–°é—´éš” | 33ms | çº¦30fps |
| æ’å€¼ç®—æ³• | INTER_AREA | é«˜è´¨é‡ç¼©æ”¾ |

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### æ–¹å¼1: ä½¿ç”¨æœ¬åœ°æ‘„åƒå¤´

```bash
# 1. è¿è¡Œä¸»çª—å£
/usr/local/bin/python3 gui/main_window.py

# 2. ç‚¹å‡»"â–¶ å¼€å§‹æ£€æµ‹"
# 3. é€‰æ‹©"ğŸ“· æœ¬åœ°æ‘„åƒå¤´"
# 4. æ‘„åƒå¤´è§†é¢‘å¼€å§‹æ˜¾ç¤º
```

### æ–¹å¼2: ä½¿ç”¨RTSPæµ

```bash
# 1. è¿è¡Œä¸»çª—å£
/usr/local/bin/python3 gui/main_window.py

# 2. ç‚¹å‡»"â–¶ å¼€å§‹æ£€æµ‹"
# 3. é€‰æ‹©"ğŸ“¡ RTSPç½‘ç»œæµ"
# 4. è¾“å…¥RTSPåœ°å€ï¼Œä¾‹å¦‚ï¼š
#    rtsp://admin:password@192.168.1.100:554/stream
# 5. ç½‘ç»œè§†é¢‘å¼€å§‹æ˜¾ç¤º
```

## ğŸ® æ§åˆ¶åŠŸèƒ½

| æ“ä½œ | åŠŸèƒ½ |
|------|------|
| â–¶ å¼€å§‹æ£€æµ‹ | æ‰“å¼€è§†é¢‘æºé€‰æ‹©å¯¹è¯æ¡†ï¼Œå¯åŠ¨è§†é¢‘æµ |
| â¸ æš‚åœ | æš‚åœè§†é¢‘æ’­æ”¾ï¼ˆä¸é‡Šæ”¾èµ„æºï¼‰ |
| â¸ æ¢å¤ | ç»§ç»­æ’­æ”¾è§†é¢‘ |
| â¹ åœæ­¢ | åœæ­¢è§†é¢‘æµå¹¶é‡Šæ”¾æ‰€æœ‰èµ„æº |

## ğŸ” è°ƒè¯•ä¿¡æ¯

ç¨‹åºä¼šåœ¨æ§åˆ¶å°è¾“å‡ºä»¥ä¸‹ä¿¡æ¯ï¼š

```
æ­£åœ¨æ‰“å¼€æœ¬åœ°æ‘„åƒå¤´...
æœ¬åœ°æ‘„åƒå¤´å·²å¯åŠ¨
```

æˆ–

```
æ­£åœ¨è¿æ¥RTSPæµ: rtsp://...
RTSPæµå·²å¯åŠ¨
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ‘„åƒå¤´æƒé™**: macOSéœ€è¦æˆäºˆç»ˆç«¯/Pythonæ‘„åƒå¤´è®¿é—®æƒé™
2. **RTSPè¿æ¥**: ç¡®ä¿ç½‘ç»œå¯è¾¾ä¸”è®¤è¯ä¿¡æ¯æ­£ç¡®
3. **æ€§èƒ½**: é«˜åˆ†è¾¨ç‡è§†é¢‘å¯èƒ½éœ€è¦æ›´å¼ºçš„CPU
4. **åƒåœ¾å›æ”¶**: å¿…é¡»ä¿æŒPhotoImageçš„å¼•ç”¨

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `RTSP_USAGE.md` - RTSPæµè¯¦ç»†ä½¿ç”¨è¯´æ˜
- `main_window.py` - ä¸»çª—å£å®ç°ä»£ç 
